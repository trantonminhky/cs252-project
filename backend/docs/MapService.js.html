<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>MapService.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AIService.html">AIService</a><ul class='methods'><li data-type='method'><a href="AIService.html#generateReviews">generateReviews</a></li><li data-type='method'><a href="AIService.html#sendPrompt">sendPrompt</a></li></ul></li><li><a href="DBService.html">DBService</a><ul class='methods'><li data-type='method'><a href="DBService.html#clear">clear</a></li><li data-type='method'><a href="DBService.html#clearAll">clearAll</a></li><li data-type='method'><a href="DBService.html#export">export</a></li><li data-type='method'><a href="DBService.html#exportAll">exportAll</a></li></ul></li><li><a href="EventService.html">EventService</a><ul class='methods'><li data-type='method'><a href="EventService.html#createEvent">createEvent</a></li><li data-type='method'><a href="EventService.html#importToDB">importToDB</a></li></ul></li><li><a href="GeocodeService.html">GeocodeService</a><ul class='methods'><li data-type='method'><a href="GeocodeService.html#geocode">geocode</a></li><li data-type='method'><a href="GeocodeService.html#reverseGeocode">reverseGeocode</a></li></ul></li><li><a href="LocationService.html">LocationService</a><ul class='methods'><li data-type='method'><a href="LocationService.html#importToDB">importToDB</a></li><li data-type='method'><a href="LocationService.html#search">search</a></li></ul></li><li><a href="MapService.html">MapService</a><ul class='methods'><li data-type='method'><a href="MapService.html#getRoute">getRoute</a></li><li data-type='method'><a href="MapService.html#nearby">nearby</a></li></ul></li><li><a href="ProfileService.html">ProfileService</a><ul class='methods'><li data-type='method'><a href="ProfileService.html#addSavedPlace">addSavedPlace</a></li><li data-type='method'><a href="ProfileService.html#getSavedPlaces">getSavedPlaces</a></li><li data-type='method'><a href="ProfileService.html#login">login</a></li><li data-type='method'><a href="ProfileService.html#refresh">refresh</a></li><li data-type='method'><a href="ProfileService.html#register">register</a></li><li data-type='method'><a href="ProfileService.html#removeSavedPlace">removeSavedPlace</a></li><li data-type='method'><a href="ProfileService.html#setPreferences">setPreferences</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">MapService.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import axios from 'axios';
import config from '../config/config.js';
import ServiceResponse from '../helper/ServiceResponse.js';
import CacheDB from '../db/CacheDB.js';

const MAP_CACHE_LIFETIME_MS = 120000; // 2 minutes

/**
 * Map service provider class.
 * @class
 */
class MapService {
	constructor() {
		this.APIKey = config.openRouteService.APIKey;
		this.baseURL = config.openRouteService.baseURL;
	}

	/**
	 * Service function for &lt;code>/api/map/route&lt;/code>. Get the fastest path between two points and their geometries. Supports &lt;codes>POST&lt;/code> requests.
	 * @param {Array&lt;Array&lt;Number>>} coordinates - Precisely two pairs of coordinates indicating the start coordinates and the end coordinates
	 * @param {String} [profile='driving-car'] - Traveling method
	 * @returns {Promise&lt;ServiceResponse>}
	 * 
	 * @example &lt;caption>cURL&lt;/caption>
	 * curl -X POST \
	 * --header 'Content-Type:application/json' \
	 * --header 'Authorization:Bearer MIKU_MIKU_OO_EE_OO' \
	 * --data '{"coordinates":[[106.682383,10.762601],[106.680562,10.760286]],"profile":"foot-walking"}' \
	 * http://localhost:3000/api/map/route
	 * 
	 * @example &lt;caption>Response&lt;/caption>
	 * {
	 *	"success": true,
	 *	"statusCode": 200,
	 *	"payload": {
	 * 		"message": "Success (OK)",
	 * 		"data": {
	 *			"type": "FeatureCollection",
	 *			"bbox": [
	 *				106.680631,
	 *				10.760119,
	 *				106.683203,
	 *				10.762839
	 *			],
	 *			"features": [
	 *				{
	 *					"bbox": [
	 *						106.680631,
	 *						10.760119,
	 *						106.683203,
	 *						10.762839
	 *					],
	 *					"type": "Feature",
	 *					"properties": {
	 *						"segments": [
	 *							{
	 *								"distance": 526.2,
	 *								"duration": 378.9,
	 *								"steps": [
	 *									{
	 *										"distance": 23.3,
	 *										"duration": 16.8,
	 *										"type": 11,
	 *										"instruction": "Head east",
	 *										"name": "-",
	 *										"way_points": [
	 *											0,
	 *											1
	 *										]
	 *									},
	 *									{
	 *										"distance": 196.2,
	 *										"duration": 141.2,
	 *										"type": 1,
	 *										"instruction": "Turn right onto Đường Nguyễn Văn Cừ",
	 *										"name": "Đường Nguyễn Văn Cừ",
	 *										"way_points": [
	 *											1,
	 *											5
	 *										]
	 *									},
	 *									{
	 *										"distance": 306.8,
	 *										"duration": 220.9,
	 *										"type": 1,
	 *										"instruction": "Turn right onto An Dương Vương",
	 *										"name": "An Dương Vương",
	 *										"way_points": [
	 *											5,
	 *											13
	 *										]
	 *									},
	 *									{
	 *										"distance": 0,
	 *										"duration": 0,
	 *										"type": 10,
	 *										"instruction": "Arrive at An Dương Vương, on the right",
	 *										"name": "-",
	 *										"way_points": [
	 *											13,
	 *											13
	 *										]
	 *									}
	 *								]
	 *							}
	 *						],
	 *						"way_points": [
	 *							0,
	 *							13
	 *						],
	 *						"summary": {
	 *							"distance": 526.2,
	 *							"duration": 378.9
	 *						}
	 *					},
	 *					"geometry": {
	 *						"coordinates": [
	 *							[
	 *								106.682322,
	 *								10.76277
	 *							],
	 *							[
	 *								106.682523,
	 *								10.762839
	 *							],
	 *							[
	 *								106.682795,
	 *								10.762162
	 *							],
	 *							[
	 *								106.682917,
	 *								10.761877
	 *							],
	 *							[
	 *								106.68319,
	 *								10.761243
	 *							],
	 *							[
	 *								106.683203,
	 *								10.761207
	 *							],
	 *							[
	 *								106.683096,
	 *								10.76111
	 *							],
	 *							[
	 *								106.682416,
	 *								10.760836
	 *							],
	 *							[
	 *								106.682327,
	 *								10.760801
	 *							],
	 *							[
	 *								106.681916,
	 *								10.760636
	 *							],
	 *							[
	 *								106.681812,
	 *								10.760594
	 *							],
	 *							[
	 *								106.68177,
	 *								10.760577
	 *							],
	 *							[
	 *								106.681406,
	 *								10.760431
	 *							],
	 *							[
	 *								106.680631,
	 *								10.760119
	 *							]
	 *						],
	 *						"type": "LineString"
	 *					}
	 *				}
	 *			],
	 *			"metadata": {
	 *				"attribution": "openrouteservice.org | OpenStreetMap contributors",
	 *				"service": "routing",
	 *				"timestamp": 1765249137165,
	 *				"query": {
	 *					"coordinates": [
	 *						[
	 *							106.682383,
	 *							10.762601
	 *						],
	 *						[
	 *							106.680562,
	 *							10.760286
	 *						]
	 *					],
	 *					"profile": "foot-walking",
	 *					"profileName": "foot-walking",
	 *					"format": "json"
	 *				},
	 *				"engine": {
	 *					"version": "9.5.0",
	 *					"build_date": "2025-10-31T12:33:09Z",
	 *					"graph_date": "2025-12-01T15:08:08Z",
	 *					"osm_date": "2025-11-24T00:59:59Z"
	 *				}
	 *			}
	 *		}
	 *	}
	 * }
	 * 
	 * @property {OK} 200 - Successful request
	 * @property {BAD_REQUEST} 400 - Missing coordinates, the given coordinates is not an array, or there aren't precisely two coordinates pairs in the array
	 * @property {UNAUTHORIZED} 401 - No bearer JWT was specified, or the JWT verification failed (invalid or expired)
	 * @property {METHOD_NOT_ALLOWED} 405 - The endpoint does not support the HTTP method specified
	 * @property {UNSUPPORTED_MEDIA} 415 - Request does not have &lt;code>Content-Type:application/json&lt;/code> header
	 * @property {INTERNAL_SERVER_ERROR} 500 - Something went wrong with the backend (cooked)
	 * @property {BAD_GATEWAY} 502 - The given coordinates do not exist on the map, or something went wrong with the upstream APIs (cooked)
	 */
	async getRoute(coordinates, profile = 'driving-car') {
		const cache = CacheDB.findRoute(coordinates, profile);

		if (cache &amp;&amp; Date.now() - cache.createdAt &lt; MAP_CACHE_LIFETIME_MS) {
			const response = new ServiceResponse(
				true,
				200,
				"Success",
				cache.data
			);
			return response;
		}

		const fromCoordinates = coordinates[0].map(coor => coor.toString()).join(',');
		const toCoordinates = coordinates[1].map(coor => coor.toString()).join(',');

		try {
			const url = `${this.baseURL}/v2/directions/${profile}`;
			const axiosResponse = await axios.get(url, {
				params: {
					api_key: this.APIKey,
					start: fromCoordinates,
					end: toCoordinates
				}
			});

			CacheDB.upsertRoute({
				coordinates: coordinates,
				profile: profile,
				data: axiosResponse.data,
				createdAt: Date.now()
			});

			const response = new ServiceResponse(
				true,
				200,
				"Success",
				axiosResponse.data
			);
			return response;
		} catch (err) {
			const response = new ServiceResponse(
				false,
				502,
				"Something went wrong",
				err.toString()
			);
			return response;
		}
	}

	/**
	 * Service function for &lt;code>/api/map/nearby&lt;/code>. Returns a list of nearby points of interest (POIs) from a coordinate. &lt;b>This method is temporarily disabled because ORS is retarded&lt;/b>. Supports &lt;code>POST&lt;/code> requests.
	 * @param {Number} lat - Latitude
	 * @param {Number} lon - Longitude
	 * @param {Number} [radius=1000] - Maximum distance to look for. Note that radius must be between 0 and 2000
	 * @param {Array&lt;Number>} [category_ids=[]] - IDs of POIs to filter. By default none is excluded. Refer to &lt;a href="https://github.com/GIScience/openpoiservice/blob/main/openpoiservice/server/categories/categories.yml" target="_blank">this&lt;/a> for which ID corresponds to which types of POIs
	 * 
	 * @property {SERVICE_UNAVAILABLE} 503 - Can you read?
	 */
	async nearby(lat, lon, radius = 1000, category_ids = []) {
		let filters = {};

		if (category_ids.length) {
			filters.category_ids = category_ids;
		}

		try {
			const url = `${this.baseURL}/pois`;
			const axiosResponse = await axios.post(url, {
				request: "pois",
				geometry: {
					geojson: {
						type: "Point",
						coordinates: [lon, lat]
					},
					buffer: radius
				},
				filters
			}, {
				headers: {
					Authorization: this.APIKey
				}
			});

			let resp;
			if (typeof axiosResponse.data === 'string' || axiosResponse.data instanceof String) {
				resp = {};
			} else {
				resp = axiosResponse.data;
			}

			const response = new ServiceResponse(
				true,
				200,
				"Success",
				resp
			);
			return response;
		} catch (err) {
			const response = new ServiceResponse(
				false,
				502,
				"Something went wrong",
				err.toString()
			);
			return response;
		}
	}
}

export default new MapService();</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Dec 09 2025 11:34:41 GMT+0700 (Indochina Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



    <link type="text/css" rel="stylesheet" href="docdash-custom.css">
    
</body>
</html>
